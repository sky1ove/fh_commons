# Protein display


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Setup

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/fh_commons/blob/main/fh_commons/protein.py#L17"
target="_blank" style="float:right; font-size:smaller">source</a>

### AF_display

>      AF_display ()

*client side scripts*

------------------------------------------------------------------------

<a
href="https://github.com/sky1ove/fh_commons/blob/main/fh_commons/protein.py#L22"
target="_blank" style="float:right; font-size:smaller">source</a>

### pdbe_molstar

>      pdbe_molstar ()

*Headers*

``` python
hdrs = bootstrap_hdrs() + pdbe_molstar()
```

``` python
show(*hdrs)
```

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script><link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
<script>
            document.addEventListener('htmx:load', function() {
                var tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
                var tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
            });
        </script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pdbe-molstar@3.2.0/build/pdbe-molstar-light.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pdbe-molstar@3.2.0/build/pdbe-molstar-plugin.js"></script><style>
          #myViewer {
            float: left;
            width: 100%;
            height: 600px;
            position: relative;
            margin: 0px;
          }
          .msp-plugin ::-webkit-scrollbar-thumb {
            background-color: #474748 !important;
            border-radius: 10px;
          }
          .msp-right-panel { 
            display: none !important; 
          }
          #protein-form {
            margin: 20px;
          }
          &#10;        </style>
<script>if (window.htmx) htmx.process(document.body)</script>

``` python
from ngrok_token import *
url = start_ngrok(token)
```

    ngrok tunnel opened at: https://9771-3-91-16-70.ngrok-free.app

``` python
app,rt = fast_app(pico=False,hdrs=hdrs)
server = JupyUvi(app)
```

<script>
document.body.addEventListener('htmx:configRequest', (event) => {
    if(event.detail.path.includes('://')) return;
    htmx.config.selfRequestsOnly=false;
    event.detail.path = `${location.protocol}//${location.hostname}:8000${event.detail.path}`;
});
</script>

## Check output format

``` python
df = pd.read_parquet('data/AM.parquet')
```

``` python
@rt
def test():
    form = Form(Input(id='uniprot_id'),Button('load'),hx_get='/sdf',target_id='result')
    result = Div(id='result')
    return Div(form, result)

@rt
def sdf(uniprot_id:str):
    protein_data = df[df['uniprot'] == uniprot_id].copy()

    if protein_data.empty:
        return Div('Uniprot id not found in the phosphosite database')

    protein_data['residue'] = protein_data.site.str[1:].astype(int)
    protein_data['CDDM_kinases'] = protein_data['CDDM'].str.split(',').str[:5]
    protein_data['PSPA_kinases'] = protein_data['PSPA'].str.split(',').str[:5]
    protein_data['AM_pathogenicity'] = protein_data['AM_pathogenicity'].round(4)

    # Convert the filtered data to a list of dictionaries
    # It needs to include residue, as it uses residue number to highlight
    out = protein_data[['residue', 'AM_pathogenicity','site_seq','source','CDDM_kinases','PSPA_kinases']]

    return Container(df2html(out))
```

``` python
htmx(url,'/sdf?uniprot_id=P10398')
```

<iframe src="https://9771-3-91-16-70.ngrok-free.app/sdf?uniprot_id=P10398" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 

## Protein Display

P10398 P35222

Key listeners:

- uniprot_id: input text
- load-protein-btn: click to load new protein
- myViewer: display protein
- AF_view: control alphafold color on or off

``` python
@rt('/')
def get():
    form = Form(
        Input(type='text', id = 'uniprot_id', placeholder='Enter Uniprot ID (e.g., P10398)'),
        Button('Load Protein', type='button',id='load-protein-btn'),
        id='protein-form',
    )
    viewer = Div(id='myViewer')
    # script = Script(src="./imports/alphafold_display.js")
    AF_button = Button('Turn On/Off Alphafold Color', type='button',id='AF_view'),
    blank=Div(style='height: 600px;')

    return Titled('PDBe Mol* JS Plugin Demo - AlphaFold View', form, AF_button, viewer, AF_script, blank)


@rt('/api/protein/{uniprot_id}')
def get(uniprot_id: str):
    # Filter the dataframe for the given UniProt ID
    protein_data = df[df['uniprot'] == uniprot_id].copy()

    if protein_data.empty:
        return {'error': 'Uniprot id not found in the phosphosite database'}

    protein_data['residue'] = protein_data.site.str[1:].astype(int)
    protein_data['CDDM_kinases'] = protein_data['CDDM'].str.split(',').str[:5]
    protein_data['PSPA_kinases'] = protein_data['PSPA'].str.split(',').str[:5]
    protein_data['AM_pathogenicity'] = protein_data['AM_pathogenicity'].round(4)

    # Convert the filtered data to a list of dictionaries
    # It needs to include residue, as it uses residue number to highlight
    site_data = protein_data[['residue', 'AM_pathogenicity','site_seq','source','CDDM_kinases','PSPA_kinases']].to_dict('records')

    return {'site_data': site_data}
```

``` python
htmx(url,'/')
```

<iframe src="https://9771-3-91-16-70.ngrok-free.app/" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 

## End

``` python
server.stop()
kill_ngrok()
```

    ngrok tunnel killed
